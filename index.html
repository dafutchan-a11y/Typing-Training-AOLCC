<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Typing Trainer</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 800px;
            width: 100%;
            padding: 32px;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 8px;
            font-size: 1.8rem;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 24px;
            font-size: 0.95rem;
        }

        .stats-bar {
            display: flex;
            justify-content: space-around;
            background: #f8f9fa;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 24px;
            flex-wrap: wrap;
            gap: 12px;
        }

        .stat {
            text-align: center;
            min-width: 80px;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #667eea;
        }

        .stat-label {
            font-size: 0.75rem;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .controls {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .controls select, .controls button {
            padding: 10px 16px;
            border-radius: 8px;
            font-size: 0.9rem;
            cursor: pointer;
        }

        .controls select {
            border: 2px solid #e0e0e0;
            background: white;
            flex: 1;
            min-width: 150px;
        }

        .controls select:focus {
            outline: none;
            border-color: #667eea;
        }

        .controls button {
            background: #667eea;
            color: white;
            border: none;
            font-weight: 600;
            transition: background 0.2s;
        }

        .controls button:hover {
            background: #5a6fd6;
        }

        .controls button.secondary {
            background: #6c757d;
        }

        .controls button.secondary:hover {
            background: #5a6268;
        }

        .text-display {
            background: #1e1e1e;
            border-radius: 12px;
            padding: 24px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 1.25rem;
            line-height: 1.8;
            margin-bottom: 20px;
            min-height: 150px;
            color: #666;
            position: relative;
            word-wrap: break-word;
            overflow-wrap: break-word;
            white-space: pre-wrap;
            overflow-y: auto;
            max-height: 300px;
        }

        .text-display .char {
            transition: color 0.1s;
            display: inline;
            word-break: break-word;
        }

        .text-display .char.correct {
            color: #4ade80;
        }

        .text-display .char.incorrect {
            color: #f87171;
            text-decoration: underline;
        }

        .text-display .char.current {
            background: rgba(102, 126, 234, 0.4);
            border-radius: 2px;
        }

        .text-display .char.pending {
            color: #888;
        }

        .input-area {
            position: relative;
        }

        .typing-input {
            width: 100%;
            padding: 16px;
            font-size: 1.1rem;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .typing-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        }

        .typing-input:disabled {
            background: #f0f0f0;
            cursor: not-allowed;
        }

        .typing-input.error {
            border-color: #f87171;
            box-shadow: 0 0 0 3px rgba(248, 113, 113, 0.2);
        }

        .message {
            text-align: center;
            padding: 20px;
            margin-top: 20px;
            border-radius: 12px;
            display: none;
        }

        .message.success {
            background: #dcfce7;
            color: #166534;
            display: block;
        }

        .message h3 {
            margin-bottom: 8px;
        }

        .progress-bar {
            height: 6px;
            background: #e0e0e0;
            border-radius: 3px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-bar .fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 3px;
            transition: width 0.2s;
        }

        .instructions {
            text-align: center;
            color: #666;
            font-size: 0.85rem;
            margin-top: 16px;
        }

        .custom-text-area {
            display: none;
            margin-bottom: 16px;
        }

        .custom-text-area.visible {
            display: block;
        }

        .custom-text-area textarea {
            width: 100%;
            padding: 12px;
            font-size: 0.95rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            resize: vertical;
            min-height: 80px;
            font-family: inherit;
        }

        .custom-text-area textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 1.4rem;
            }

            .text-display {
                font-size: 1rem;
                padding: 16px;
            }

            .stat-value {
                font-size: 1.4rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚å®Ô∏è Typing Trainer</h1>
        <p class="subtitle">Improve your typing speed and accuracy</p>

        <div class="stats-bar">
            <div class="stat">
                <div class="stat-value" id="wpm">0</div>
                <div class="stat-label">WPM</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="accuracy">100%</div>
                <div class="stat-label">Accuracy</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="errors">0</div>
                <div class="stat-label">Errors</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="time">0:00</div>
                <div class="stat-label">Time</div>
            </div>
        </div>

        <div class="controls">
            <select id="difficulty">
                <option value="beginner">Beginner - Home Row</option>
                <option value="easy">Easy - Common Words</option>
                <option value="medium" selected>Medium - Sentences</option>
                <option value="hard">Hard - Complex Text</option>
                <option value="code">Code - Programming</option>
                <option value="custom">Custom Text</option>
            </select>
            <button id="newText">New Text</button>
            <button id="restart" class="secondary">Restart</button>
        </div>

        <div class="custom-text-area" id="customArea">
            <textarea id="customText" placeholder="Enter your custom text here..."></textarea>
        </div>

        <div class="progress-bar">
            <div class="fill" id="progress" style="width: 0%"></div>
        </div>

        <div class="text-display" id="textDisplay"></div>

        <div class="input-area">
            <input 
                type="text" 
                id="typingInput" 
                class="typing-input" 
                placeholder="Click here and start typing..."
                autocomplete="off"
                autocorrect="off"
                autocapitalize="off"
                spellcheck="false"
            >
        </div>

        <div class="message" id="message">
            <h3>üéâ Excellent Work!</h3>
            <p id="finalStats"></p>
        </div>

        <p class="instructions">Start typing to begin. Your stats will update in real-time.</p>
    </div>

    <script>
        const texts = {
            beginner: [
                "asdf jkl; asdf jkl; asdf jkl;",
                "fjfj dkdk slsl a;a; fjdk sla;",
                "sad lad fall all dad add fad",
                "ask flask glad salad shall staff"
            ],
            easy: [
                "the quick brown fox jumps over the lazy dog",
                "pack my box with five dozen liquor jugs",
                "how vexingly quick daft zebras jump",
                "the five boxing wizards jump quickly"
            ],
            medium: [
                "Learning to type quickly and accurately is an essential skill in today's digital world. Practice makes perfect, so keep at it every day.",
                "The ability to communicate effectively through writing has never been more important. Clear and concise typing helps you express your ideas.",
                "Technology continues to shape how we work and learn. Developing strong keyboard skills will serve you well throughout your career.",
                "Success comes to those who are willing to put in the effort. Every keystroke brings you closer to mastery of this valuable skill."
            ],
            hard: [
                "The phenomenon of quantum entanglement suggests that particles can be connected in ways that transcend classical physics, challenging our understanding of space and time.",
                "Cryptocurrency markets exhibit extraordinary volatility, with prices fluctuating dramatically based on regulatory announcements, technological developments, and market sentiment.",
                "The implementation of sustainable development goals requires coordinated international cooperation, innovative financing mechanisms, and transformative approaches to economic growth."
            ],
            code: [
                "function calculateSum(arr) { return arr.reduce((a, b) => a + b, 0); }",
                "const users = await fetch('/api/users').then(res => res.json());",
                "if (condition && otherCondition) { handleSuccess(); } else { handleError(); }",
                "class Rectangle { constructor(w, h) { this.width = w; this.height = h; } }"
            ],
            custom: []
        };

        let currentText = "";
        let currentIndex = 0;
        let errors = 0;
        let totalKeystrokes = 0;
        let startTime = null;
        let timerInterval = null;
        let isComplete = false;

        const textDisplay = document.getElementById('textDisplay');
        const typingInput = document.getElementById('typingInput');
        const wpmDisplay = document.getElementById('wpm');
        const accuracyDisplay = document.getElementById('accuracy');
        const errorsDisplay = document.getElementById('errors');
        const timeDisplay = document.getElementById('time');
        const progressBar = document.getElementById('progress');
        const difficultySelect = document.getElementById('difficulty');
        const newTextBtn = document.getElementById('newText');
        const restartBtn = document.getElementById('restart');
        const messageDiv = document.getElementById('message');
        const finalStats = document.getElementById('finalStats');
        const customArea = document.getElementById('customArea');
        const customTextArea = document.getElementById('customText');

        function getRandomText(difficulty) {
            if (difficulty === 'custom') {
                const customText = customTextArea.value.trim();
                return customText || "Please enter custom text above.";
            }
            const textArray = texts[difficulty];
            return textArray[Math.floor(Math.random() * textArray.length)];
        }

        function renderText() {
            textDisplay.innerHTML = currentText.split('').map((char, index) => {
                let className = 'char';
                if (index < currentIndex) {
                    const typed = typingInput.value[index];
                    className += typed === char ? ' correct' : ' incorrect';
                } else if (index === currentIndex) {
                    className += ' current pending';
                } else {
                    className += ' pending';
                }
                // Handle space display - use regular space for proper wrapping
                const displayChar = char === ' ' ? ' ' : char;
                return `<span class="${className}">${displayChar}</span>`;
            }).join('');
        }

        function updateStats() {
            if (!startTime) return;

            const elapsedTime = (Date.now() - startTime) / 1000;
            const minutes = elapsedTime / 60;
            
            // Calculate WPM (words = characters / 5)
            const wordsTyped = currentIndex / 5;
            const wpm = minutes > 0 ? Math.round(wordsTyped / minutes) : 0;
            
            // Calculate accuracy
            const accuracy = totalKeystrokes > 0 
                ? Math.round(((totalKeystrokes - errors) / totalKeystrokes) * 100) 
                : 100;

            wpmDisplay.textContent = wpm;
            accuracyDisplay.textContent = accuracy + '%';
            errorsDisplay.textContent = errors;
            
            // Update progress bar
            const progress = (currentIndex / currentText.length) * 100;
            progressBar.style.width = progress + '%';
        }

        function updateTimer() {
            if (!startTime) return;
            
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            timeDisplay.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        function completeTest() {
            isComplete = true;
            clearInterval(timerInterval);
            typingInput.disabled = true;
            
            const elapsedTime = (Date.now() - startTime) / 1000;
            const minutes = elapsedTime / 60;
            const wordsTyped = currentText.length / 5;
            const finalWpm = Math.round(wordsTyped / minutes);
            const finalAccuracy = totalKeystrokes > 0 
                ? Math.round(((totalKeystrokes - errors) / totalKeystrokes) * 100) 
                : 100;

            finalStats.textContent = `Final Speed: ${finalWpm} WPM | Accuracy: ${finalAccuracy}% | Time: ${timeDisplay.textContent}`;
            messageDiv.classList.add('success');
        }

        function resetTest() {
            currentIndex = 0;
            errors = 0;
            totalKeystrokes = 0;
            startTime = null;
            isComplete = false;
            
            clearInterval(timerInterval);
            
            typingInput.value = '';
            typingInput.disabled = false;
            typingInput.classList.remove('error');
            
            wpmDisplay.textContent = '0';
            accuracyDisplay.textContent = '100%';
            errorsDisplay.textContent = '0';
            timeDisplay.textContent = '0:00';
            progressBar.style.width = '0%';
            
            messageDiv.classList.remove('success');
            
            renderText();
            typingInput.focus();
        }

        function loadNewText() {
            currentText = getRandomText(difficultySelect.value);
            resetTest();
        }

        function handleInput(e) {
            if (isComplete) return;

            const typed = typingInput.value;
            
            // Start timer on first keystroke
            if (!startTime && typed.length > 0) {
                startTime = Date.now();
                timerInterval = setInterval(updateTimer, 1000);
            }

            // Check each character
            const newIndex = typed.length;
            
            // If user typed more characters
            if (newIndex > currentIndex) {
                totalKeystrokes++;
                const typedChar = typed[newIndex - 1];
                const expectedChar = currentText[newIndex - 1];
                
                if (typedChar !== expectedChar) {
                    errors++;
                    typingInput.classList.add('error');
                    setTimeout(() => typingInput.classList.remove('error'), 150);
                }
            }

            currentIndex = newIndex;
            renderText();
            updateStats();

            // Check if complete
            if (currentIndex >= currentText.length) {
                completeTest();
            }
        }

        // Prevent paste
        typingInput.addEventListener('paste', (e) => {
            e.preventDefault();
        });

        typingInput.addEventListener('input', handleInput);
        
        newTextBtn.addEventListener('click', loadNewText);
        restartBtn.addEventListener('click', resetTest);
        
        difficultySelect.addEventListener('change', () => {
            if (difficultySelect.value === 'custom') {
                customArea.classList.add('visible');
            } else {
                customArea.classList.remove('visible');
            }
            loadNewText();
        });

        customTextArea.addEventListener('input', () => {
            if (difficultySelect.value === 'custom') {
                loadNewText();
            }
        });

        // Initialize
        loadNewText();
    </script>
</body>
</html>
